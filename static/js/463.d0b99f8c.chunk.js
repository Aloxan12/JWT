"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[463],{6732:(e,t,s)=>{s.r(t),s.d(t,{default:()=>W});var i=s(9060);const a="Posts_postBlock__TuvF-",l="Posts_postsItems__6kXGQ";var n=s(2140),o=s(454),r=s(9860),d=s(216),c=s(7844),u=s(740);const p=s(6056).LU.injectEndpoints({endpoints:e=>({getAllPosts:e.query({query:e=>({url:"/posts",params:e||{}}),providesTags:["Posts","Users"]}),createPosts:e.mutation({query:e=>({url:"/posts",method:"POST",body:e})}),likePost:e.mutation({query:e=>{let{id:t}=e;return{url:"/posts/".concat(t,"/like"),method:"PATCH"}},invalidatesTags:(e,t,s)=>[{type:"Posts",id:s.id}]}),deletePost:e.mutation({query:e=>{let{id:t}=e;return{url:"/posts/".concat(t),method:"DELETE"}},invalidatesTags:(e,t,s)=>[{type:"Posts",id:s.id}]})})}),{useGetAllPostsQuery:h,useCreatePostsMutation:m,useLikePostMutation:g,useDeletePostMutation:x}=p;var k=s(3380),j=s.n(k),C=s(6712),_=s(2496);const v=e=>{let{setCurrentData:t}=e;const s=(0,C.w1)((e=>e.auth.user)),[a,l]=(0,i.useState)(""),[n,{isLoading:o}]=m();return(0,_.jsxs)(c.C,{direction:"column",align:"start",max:!0,gap:"16",children:[(0,_.jsx)(r.G,{value:a,onChange:l,fullWidth:!0,rows:"3"}),(0,_.jsx)(d.O,{title:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c",onClick:()=>{s&&""!==a&&n({author:s.id,postText:a,publicDate:j()(new Date).toISOString()}).then((e=>{const s=e.data.post;l(""),t((e=>[s,...e])),(0,u.S)({msg:"\u041f\u043e\u0441\u0442 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d".replace(/"/g,""),type:u.W.success})}))},theme:"full-bg",disabled:!a,isLoading:o})]})},f={postsItem:"Post_postsItem__WtXR8",postDateBlock:"Post_postDateBlock__dkPvd",email:"Post_email__RlJ5t",postLikeBlock:"Post_postLikeBlock__pPpJ5",likeActive:"Post_likeActive__D9EwX",likeLoading:"Post_likeLoading__uCHUm",postsItemContent:"Post_postsItemContent__pyt4f"};var b=s(9360);(()=>{let e={}})();const P=s.p+"static/media/trash.ff6de8f4b8e11b0d507d.png",L={trash:"AppTrash_trash__kZGY9",small:"AppTrash_small__abggq",medium:"AppTrash_medium__Wbl99",big:"AppTrash_big__1D8jV",trashModelContent:"AppTrash_trashModelContent__dpjKk"};var w=s(4582),y=s(8856),D=s(1620);const T=e=>{let{size:t="big",deleteHandler:s,text:a}=e;const[l,n]=(0,i.useState)(!1),o=()=>n(!1);return(0,_.jsxs)(i.Fragment,{children:[(0,_.jsx)(w.w,{src:P,alt:"\u043a\u043e\u0440\u0437\u0438\u043d\u0430",className:(0,D.g)(L.trash,{},[L[t]]),onClick:()=>n(!0)}),(0,_.jsx)(y.I,{isOpen:l,onClose:o,title:"\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435",lazy:!0,children:(0,_.jsxs)(c.C,{direction:"column",gap:"16",align:"start",children:[(0,_.jsx)("div",{children:a||"\u0423\u0434\u0430\u043b\u0438\u0442\u044c?"}),(0,_.jsxs)(c.C,{justify:"between",max:!0,children:[(0,_.jsx)(d.O,{onClick:o,title:"\u043d\u0435\u0442",theme:"full-bg"}),(0,_.jsx)(d.O,{onClick:()=>{s(o)},theme:"full-bg",title:"\u0434\u0430"})]})]})})]})},S=s.p+"static/media/like.5f22da937dbad35f573f.png";var A=s(148),I=s(2300);const R=(0,i.memo)((e=>{var t;let{post:s,isAdmin:a,measureRef:l,likePost:n,deletePost:o,likeLoading:r}=e;const[d,u]=(0,i.useState)(null),p={[f.likeActive]:s.isLike};return(0,_.jsxs)("li",{className:f.postsItem,ref:l,children:[(0,_.jsxs)(c.C,{max:!0,justify:"between",children:[(0,_.jsxs)(c.C,{gap:"8",children:[(0,_.jsx)(A.C,{src:(null===(t=s.author)||void 0===t?void 0:t.avatar)||""}),(0,_.jsx)(I.w,{text:s.author.email,color:"violet",bold:"600",isEllipsis:!0,className:f.email})]}),(0,_.jsxs)(c.C,{gap:"8",onClick:()=>{u(s.id)},children:[(0,_.jsxs)("div",{className:(0,D.g)(f.postLikeBlock,{...p,[f.likeLoading]:r&&d===s.id},[]),onClick:n(s.id),children:[(0,_.jsx)(w.w,{src:S,alt:"like",width:20,height:20}),s.likeCount]}),a&&(0,_.jsx)("div",{className:f.postTrashBlock,children:(0,_.jsx)(T,{deleteHandler:o(s.id),size:"medium",text:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0439 \u043f\u043e\u0441\u0442?"})})]})]}),(0,_.jsx)("div",{className:f.postDateBlock,children:(0,_.jsxs)("span",{children:[(0,_.jsx)("span",{children:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d\u043e:"})," ",j()(s.publicDate).format("DD-MM-YYYY")||"\u0414\u0430\u0442\u0430 \u043d\u0435 \u0437\u0430\u0444\u0438\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u0430"]})}),(0,_.jsx)("div",{className:f.postsItemContent,children:(h=s.postText,h.split(/\n(?!\n)/).filter((e=>""!==e)).map(((e,t)=>(0,_.jsx)("p",{children:e},"".concat(e,"- key ").concat(t)))))})]});var h}));var B=s(8628),E=s(484),M=s(4216);const N=()=>(0,_.jsxs)(c.C,{align:"start",direction:"column",gap:"32",max:!0,children:[(0,_.jsx)(M.C,{width:"100%",height:"130px",border:"12px"}),(0,_.jsx)(M.C,{width:"100%",height:"130px",border:"12px"}),(0,_.jsx)(M.C,{width:"100%",height:"130px",border:"12px"}),(0,_.jsx)(M.C,{width:"100%",height:"130px",border:"12px"})]}),O=e=>{let{dataList:t,measureRef:s,isLoading:a,setCurrentData:n}=e;const o=(0,B.Cq)(E.e),[r,d]=(e=>{const[t]=g(),[s,a]=(0,i.useState)(null);return[(0,i.useCallback)((s=>()=>{a(s),t({id:s}).then((t=>{var s;const i=null===t||void 0===t||null===(s=t.data)||void 0===s?void 0:s.post;i&&e((e=>e.map((e=>i.id===e.id?i:e))))})).finally((()=>a(null)))}),[]),s]})(n),[c,p]=(e=>{const[t]=x(),[s,a]=(0,i.useState)(null);return[(0,i.useCallback)((i=>l=>{a(s),t({id:i}).then((()=>{(0,u.S)({msg:"\u041f\u043e\u0441\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d",type:u.W.info}),e((e=>e.filter((e=>e.id!==i)))),null===l||void 0===l||l()})).finally((()=>a(null)))}),[]),s]})(n);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("ul",{className:l,children:t.map(((e,t,i)=>{const a=t===i.length-1;return(0,_.jsx)(R,{isAdmin:o,post:e,measureRef:a?s:void 0,likeLoading:e.id===d,likePost:r,deleteLoading:e.id===p,deletePost:c},e.id)}))}),a&&(0,_.jsx)(N,{})]})},q=e=>{let{getter:t,page:s,setPage:a}=e;const[l,n]=(0,i.useState)([]),{data:o,isLoading:r,isFetching:d}=t({page:s,limit:10}),{prevPage:c,nextPage:u,results:p}=o||{},{measureRef:h,isIntersecting:m,observer:g}=function(){let{root:e=null,rootMargin:t="0px",threshold:s=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const[a,l]=(0,i.useState)(),[n,o]=(0,i.useState)(!1);return{measureRef:(0,i.useCallback)((i=>{if(i){const a=new IntersectionObserver((e=>{let[t]=e;o(t.isIntersecting)}),{root:e,rootMargin:t,threshold:s});a.observe(i),l(a)}}),[e,t,s]),isIntersecting:n,observer:a}}(),x=(0,i.useCallback)((()=>{a((e=>e+1))}),[]);return(0,i.useEffect)((()=>{m&&u&&(x(),null===g||void 0===g||g.disconnect())}),[m,u,x]),(0,i.useEffect)((()=>{p&&!c&&n(p),p&&c&&n((e=>[...e,...p]))}),[p,c]),{dataList:l,measureRef:h,isLoading:r||d,setCurrentData:n}},W=()=>{const[e,t]=(0,i.useState)(1),{dataList:s,measureRef:l,isLoading:r,setCurrentData:d}=q({getter:h,page:e,setPage:t});return(0,_.jsxs)(o.O,{classNameContent:a,max:!0,boxShadow:!0,withoutBorder:!0,children:[(0,_.jsx)(n.E,{title:"\u041f\u043e\u0441\u0442\u044b",titleTag:"h1",align:"center"}),(0,_.jsx)(v,{setCurrentData:d}),(0,_.jsx)(O,{dataList:s,setCurrentData:d,measureRef:l,isLoading:r})]})}}}]);
//# sourceMappingURL=463.d0b99f8c.chunk.js.map