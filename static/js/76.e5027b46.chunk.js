"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[76],{76:(e,s,t)=>{t.r(s),t.d(s,{default:()=>U});var a=t(9060);const r="ChatPage_chatPageWrapper__lVp4Z",n="ChatPage_errorText__wmL54";var c=t(1620),o=t(7844);const i="ChatList_chatList__MSrQz",l="ChatList_chatItem__ul3Zy",u="ChatList_active__U-NA1";var d=t(148),h=t(2496);const m=e=>{let{users:s,isActive:t,currentUser:a,onClick:r}=e;const n={[u]:t};return(0,h.jsx)("div",{className:(0,c.g)(l,n,[]),onClick:r,children:s.filter((e=>e.id!==(null===a||void 0===a?void 0:a.id))).map((e=>{let{email:s,avatar:t,id:a}=e;return(0,h.jsxs)(o.C,{gap:"8",children:[(0,h.jsx)(d.C,{src:t}),(0,h.jsx)("span",{children:s})]},a)}))})};var v=t(6056);const g=v.LU.injectEndpoints({endpoints:e=>({getAllChats:e.query({query:e=>({url:"/chats/",params:e||{}}),providesTags:["Chat","Users"]}),getMessagesList:e.query({query:e=>({url:"/messages/",params:e||{}}),providesTags:["Chat","Users"]}),createChat:e.mutation({query:e=>({url:"/chats/",method:"POST",body:e})}),createMessage:e.mutation({query:e=>({url:"/messages/",method:"POST",body:e})})})}),{useGetAllChatsQuery:C,useGetMessagesListQuery:x,useCreateChatMutation:p}=g;var _=t(9360);const j=e=>{let{currentUser:s,chooseChatId:t,onChooseChatHandler:a}=e;const{data:r}=C();return(0,h.jsxs)(o.C,{direction:"column",gap:"16",align:"start",className:i,children:[(0,h.jsx)(m,{users:[{email:"\u041e\u0431\u0449\u0438\u0439",id:"1",avatar:"",role:_.Si.ADMIN,isActivated:!0,status:""}],isActive:!t,currentUser:s,onClick:a(null)}),null===r||void 0===r?void 0:r.results.map((e=>{let{id:r,users:n}=e;return(0,h.jsx)(m,{users:n,isActive:t===r,currentUser:s,onClick:a(r)},r)}))]})},f={chatListWrapper:"Chat_chatListWrapper__dNvq5",chatList:"Chat_chatList__4eBdN",messageWrap:"Chat_messageWrap__9Ulq8",corner:"Chat_corner__hOsTC",connection:"Chat_connection__Gh14m",owner:"Chat_owner__l23yO",email:"Chat_email__FNDSz"};var N=t(2300);const S=e=>{let{message:s,isOwner:t}=e;const{text:a,author:r,event:n}=s,i={[f.owner]:t};return"connection"===n?(0,h.jsxs)(o.C,{max:!0,justify:"center",className:f.connection,children:[r.email," \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f \u043a \u0447\u0430\u0442\u0443"]}):(0,h.jsxs)(o.C,{max:!0,align:"start",gap:"32",className:(0,c.g)("",i,[]),children:[(0,h.jsxs)(o.C,{direction:"column",align:"center",children:[(0,h.jsx)(d.C,{src:null===r||void 0===r?void 0:r.avatar}),(0,h.jsx)(N.w,{text:null===r||void 0===r?void 0:r.email,size:"14",className:f.email})]}),(0,h.jsxs)(o.C,{align:"start",gap:"8",className:f.messageWrap,children:[(0,h.jsx)("div",{children:a}),(0,h.jsx)("div",{className:f.corner})]})]})};var k=t(9860),y=t(216);const L=e=>{let{text:s,setText:t,sendMessage:a}=e;return(0,h.jsxs)(o.C,{className:f.chatForm,max:!0,direction:"column",gap:"16",children:[(0,h.jsx)(k.G,{placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442",value:s,onChange:t,rows:"3",fullWidth:!0}),(0,h.jsx)(y.O,{onClick:a,text:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c",max:!0,theme:"full-bg",size:"big"})]})},w=e=>{let{messages:s,socket:t,user:r,setMessages:n,chatId:c}=e;const i=(0,a.useRef)(null),[l,u]=(0,a.useState)(!0),[d,m]=(0,a.useState)(!0),{data:v}=x({chatId:c,limit:20}),[g,C]=(0,a.useState)("");(0,a.useEffect)((()=>{var e;i.current&&l&&v&&(console.log("dssd",i),null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),u(!1))}),[v]),(0,a.useEffect)((()=>{if(v&&d){const e=[...v.results].reverse().map((e=>{let{text:s,id:t,author:a,publicDate:r}=e;return{text:s,event:"message",id:t,author:a,date:r}}));n((s=>[...s,...e])),m(!1)}}),[v]);const p=(0,a.useCallback)((()=>{var e;const s={author:r,text:g,event:"message",chatId:c};null===t||void 0===t||null===(e=t.current)||void 0===e||e.send(JSON.stringify(s)),C("")}),[g,r,c]);return(0,h.jsxs)(o.C,{align:"start",direction:"column",gap:"32",className:f.chatListWrapper,children:[(0,h.jsxs)("div",{className:f.chatList,children:[s.map(((e,s)=>{var t;return(0,h.jsx)(S,{message:e,isOwner:(null===r||void 0===r?void 0:r.id)===(null===e||void 0===e||null===(t=e.author)||void 0===t?void 0:t.id)},"".concat(s,"-").concat(e.id))})),(0,h.jsx)("div",{ref:i})]}),(0,h.jsx)(L,{text:g,setText:C,sendMessage:p})]})};var b=t(8628);const U=()=>{const{user:e}=(0,b.Cq)((e=>e.auth)),[s,t]=(0,a.useState)([]),[i,l]=(0,a.useState)(!1),[u,d]=(0,a.useState)(null),m=(0,a.useRef)(null);!function(e,s,t,r){const n={id:1,event:"connection",author:r,text:"\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f \u043a\u0442\u043e-\u0442\u043e"};(0,a.useEffect)((()=>(e.current=new WebSocket(v.U3),e.current.onopen=()=>{var t;s(!0),null===(t=e.current)||void 0===t||t.send(JSON.stringify(n)),console.log("WebSocket connection opened")},e.current.onmessage=e=>{const s=JSON.parse(e.data);t((e=>[...e,s])),console.log("Received message:",s)},()=>{e.current&&(e.current.close(),console.log("WebSocket connection closed"))})),[])}(m,l,t,e);return(0,h.jsxs)(o.C,{gap:"32",align:"start",className:(0,c.g)(r),children:[!i&&(0,h.jsx)(N.w,{text:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f",color:"red",className:n}),(0,h.jsx)(j,{currentUser:e,chooseChatId:u,onChooseChatHandler:e=>()=>{t([]),d(e)}}),(0,h.jsx)(w,{messages:s,setMessages:t,socket:m,user:e,chatId:u||void 0})]})}}}]);
//# sourceMappingURL=76.e5027b46.chunk.js.map