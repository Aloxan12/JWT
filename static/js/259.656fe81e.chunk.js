"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[259],{28:function(t,e,s){s.r(e),s.d(e,{default:function(){return Y}});var n=s(9439),i=s(2791),r="Posts_postBlock__TuvF-",a="Posts_postsItems__6kXGQ",o=s(1088),l=s(4782),u=s(9744),c=s(361),d=s(4687),p=s(429),m=s(8649).iJ.injectEndpoints({endpoints:function(t){return{getAllPosts:t.query({query:function(t){return{url:"/posts",params:t||{}}},providesTags:["Posts","Users"]}),createPosts:t.mutation({query:function(t){return{url:"/posts",method:"POST",body:t}},invalidatesTags:["Posts"]}),likePost:t.mutation({query:function(t){var e=t.id;return{url:"/posts/".concat(e,"/like"),method:"PATCH"}},invalidatesTags:["Posts"]}),deletePost:t.mutation({query:function(t){var e=t.id;return{url:"/posts/".concat(e),method:"DELETE"}},invalidatesTags:["Posts"]})}}}),h=m.useGetAllPostsQuery,f=m.useCreatePostsMutation,g=m.useLikePostMutation,x=m.useDeletePostMutation,k=s(2426),v=s.n(k),_=s(2597),j=s(3329),P=function(t){var e=t.setCurrentPage,s=(0,_.v9)((function(t){return t.auth.user})),r=(0,i.useState)(""),a=(0,n.Z)(r,2),o=a[0],l=a[1],m=f(),h=(0,n.Z)(m,2),g=h[0],x=h[1].isLoading;return(0,j.jsxs)(d.k,{direction:"column",align:"start",max:!0,gap:"16",children:[(0,j.jsx)(u.W,{value:o,onChange:l,fullWidth:!0,rows:"3"}),(0,j.jsx)(c.J,{title:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c",onClick:function(){s&&""!==o&&g({author:s.id,postText:o,publicDate:v()(new Date).toISOString()}).then((function(){l(""),e(1),(0,p.y)({msg:"\u041f\u043e\u0441\u0442 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d".replace(/"/g,""),type:p.p.success})}))},theme:"full-bg",disabled:!o,isLoading:x})]})},C=s(3433),b=s(4942),T={postsItem:"Post_postsItem__WtXR8",postDateBlock:"Post_postDateBlock__dkPvd",email:"Post_email__RlJ5t",postLikeBlock:"Post_postLikeBlock__pPpJ5",likeActive:"Post_likeActive__D9EwX",postsItemContent:"Post_postsItemContent__pyt4f"},y=s(7460),A=s.p+"static/media/trash.ff6de8f4b8e11b0d507d.png",w={trash:"AppTrash_trash__kZGY9",small:"AppTrash_small__abggq",medium:"AppTrash_medium__Wbl99",big:"AppTrash_big__1D8jV",trashModelContent:"AppTrash_trashModelContent__dpjKk"},D=s(2903),E=s(4813),Z=s(3546),L=function(t){var e=t.size,s=void 0===e?"big":e,r=t.deleteHandler,a=t.text,o=(0,i.useState)(!1),l=(0,n.Z)(o,2),u=l[0],p=l[1],m=function(){return p(!1)};return(0,j.jsxs)(i.Fragment,{children:[(0,j.jsx)(D.e,{src:A,alt:"\u043a\u043e\u0440\u0437\u0438\u043d\u0430",className:(0,Z.A)(w.trash,{},[w[s]]),onClick:function(){return p(!0)}}),(0,j.jsx)(E.l,{isOpen:u,onClose:m,title:"\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435",lazy:!0,children:(0,j.jsxs)(d.k,{direction:"column",gap:"16",align:"start",children:[(0,j.jsx)("div",{children:a||"\u0423\u0434\u0430\u043b\u0438\u0442\u044c?"}),(0,j.jsxs)(d.k,{justify:"between",max:!0,children:[(0,j.jsx)(c.J,{onClick:m,title:"\u043d\u0435\u0442",theme:"full-bg"}),(0,j.jsx)(c.J,{onClick:function(){r(m)},theme:"full-bg",title:"\u0434\u0430"})]})]})})]})},B=s.p+"static/media/like.5f22da937dbad35f573f.png",N=s(6070),S=s(4634),I=function(t){var e,s=t.post,r=t.setCurrentPage,a=t.isAdmin,o=x(),l=(0,n.Z)(o,1)[0],u=g(),c=(0,n.Z)(u,1)[0],m=(0,i.useCallback)((function(){c({id:s.id})}),[s]),h=(0,b.Z)({},T.likeActive,s.isLike);return(0,j.jsxs)("li",{className:T.postsItem,children:[(0,j.jsxs)(d.k,{max:!0,justify:"between",children:[(0,j.jsxs)(d.k,{gap:"8",children:[(0,j.jsx)(N.J,{src:(null===(e=s.author)||void 0===e?void 0:e.avatar)||""}),(0,j.jsx)(S.K,{text:s.author.email,color:"violet",bold:"600",isEllipsis:!0,className:T.email})]}),(0,j.jsxs)(d.k,{gap:"8",children:[(0,j.jsxs)("div",{className:(0,Z.A)(T.postLikeBlock,h,[]),onClick:m,children:[(0,j.jsx)(D.e,{src:B,alt:"like",width:20,height:20}),s.likeCount]}),a&&(0,j.jsx)("div",{className:T.postTrashBlock,children:(0,j.jsx)(L,{deleteHandler:function(t){l({id:s.id}).then((function(e){var s=e.data;204===s.status&&(r(1),(0,p.y)({msg:s.message.replace(/"/g,""),type:p.p.info}),null===t||void 0===t||t())}))},size:"medium",text:"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0439 \u043f\u043e\u0441\u0442?"})})]})]}),(0,j.jsx)("div",{className:T.postDateBlock,children:(0,j.jsxs)("span",{children:[(0,j.jsx)("span",{children:"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d\u043e:"})," ",v()(s.publicDate).format("DD-MM-YYYY")||"\u0414\u0430\u0442\u0430 \u043d\u0435 \u0437\u0430\u0444\u0438\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u0430"]})}),(0,j.jsx)("div",{className:T.postsItemContent,children:(0,y.RV)(s.postText)})]})};var J=s(3644),M=s(8071),q=s(2035),H=function(t){var e=t.currentPage,s=t.setCurrentPage,r=(0,i.useState)(!1),o=(0,n.Z)(r,2),l=o[0],u=o[1],c=(0,M.CG)(q.s),d=(0,i.useState)([]),p=(0,n.Z)(d,2),m=p[0],f=p[1],g=h({limit:10,page:e}),x=g.data,k=g.isLoading,v=g.isFetching;(0,i.useEffect)((function(){x&&l&&1!==e?f((function(t){return[].concat((0,C.Z)(t),(0,C.Z)(x.results))})):x&&f(x.results),u(!1)}),[x]),(0,i.useEffect)((function(){l&&x&&x.count>10*e&&s((function(t){return t+1}))}),[l]);var _=function(t,e){var s=!1,n=null,i=null;return function r(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];if(s)return n=o,void(i=this);t.apply(this,o),s=!0,setTimeout((function(){s=!1,i&&(r.apply(i,n),i=null,n=o)}),e)}}((function(t){var e=t.target.documentElement,s=e.scrollTop;e.scrollHeight-(s+window.innerHeight)<50&&u(!0)}),300);return(0,i.useEffect)((function(){return document.addEventListener("scroll",_),function(){return document.removeEventListener("scroll",_)}}),[]),(0,j.jsxs)(j.Fragment,{children:[(v||k)&&(0,j.jsx)(J.Q,{}),(0,j.jsx)("ul",{className:a,children:m.map((function(t){return(0,j.jsx)(I,{isAdmin:c,post:t,setCurrentPage:s},t.id)}))})]})},Y=function(){var t=(0,i.useState)(1),e=(0,n.Z)(t,2),s=e[0],a=e[1];return(0,j.jsxs)(l.C,{classNameContent:r,max:!0,boxShadow:!0,withoutBorder:!0,children:[(0,j.jsx)(o.d,{title:"\u041f\u043e\u0441\u0442\u044b",titleTag:"h1",align:"center"}),(0,j.jsx)(P,{setCurrentPage:a}),(0,j.jsx)(H,{currentPage:s,setCurrentPage:a})]})}}}]);
//# sourceMappingURL=259.656fe81e.chunk.js.map